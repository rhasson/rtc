<html><head>
	<script src="http://cdn.binaryjs.com/0/binary.js"></script>
</head>
<body>

<video id='vid' width='200' height='200' autoplay></video>
<br>
<button id='start' >Start</button>
<button id='stop' >Stop</button>
<canvas></canvas>
</body>
<script>
	var client = new BinaryClient('ws://localhost:9000');
	client.on('open', function() {
		var localStream, i, bs_stream;
		
		document.querySelector('#start').addEventListener('click', function(evt) {
			var video, canvas, cxt;
			start();
			video = document.querySelector('video');
			canvas = document.querySelector('canvas');
			cxt = canvas.getContext('2d');
			i = setInterval(function() { capture(video, canvas, cxt) }, 100);
		}, false);
		
		document.querySelector('#stop').addEventListener('click', function(evt) {
			clearInterval(i);
			client.close();
			localStream.stop();
		}, false);

		function start() {
			navigator.webkitGetUserMedia({video: true}, function(stream) {
				localStream = stream;
				video = document.querySelector('video');
				video.src = window.webkitURL.createObjectURL(stream);
				//bs_stream = client.createStream({type: 'write'});
			});
		}

		function capture(video, canvas, cxt){
			var buf;
			canvas.width = video.videoWidth / 2;
			canvas.height = video.videoHeight / 2;
			if (video.videoWidth > 0) {
				cxt.drawImage(video, 0, 0, video.videoWidth, video.videoHeight, 0, 0, canvas.width, canvas.height);
				data = cxt.getImageData(0, 0, canvas.width, canvas.height).data;
				buf = new Uint8Array(data);
				client.send(data, {w: canvas.width, h: canvas.height});
			}
		}
	});

</script>
</html>